@model List<OgrenciBilgiSistemi.Models.Mufredat>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Diğer head etiketleri burada yer alabilir -->

    <title>Öğrenci Bilgi Sistemi</title>

    <!-- DataTables CSS ve JS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.js"></script>

    <!-- Clipboard.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>

    <!-- Diğer script etiketleri burada yer alabilir -->
    <style>
        .ozluluk-container {
            border: 2px solid #ddd; /* Çerçeve rengi */
            padding: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between; /* İki sütunu sağlı sollu hizala */
        }

            .ozluluk-container p {
                margin: 0; /* Paragrafların boşluğunu sıfırla */
            }

        .container {
            margin-top: 20px; /* İçerikten biraz uzaklaştırma */
        }
    </style>
</head>
<body>

    <h1>Öğrenci Transkript Belgesi</h1>
    <div class="container">
        <button id="copyButton" class="btn btn-primary">Kopyala</button>
        <button id="exportExcelButton" class="btn btn-success">Excele Aktar</button>
        <button id="convertButton" >PDF'e Aktar</button>
        <br />
        <br />
        <div class="tablo" id="t">
            @*tekrarlıyor öğrenci ve müfredatta*@
            @foreach (var item in Model)
            {
                foreach (var ogrenci in item.Bolum.Ogrenci)
                {
                    if (Int32.Parse(ogrenci.OgrenciNo) == Convert.ToInt32(Session["OgrenciNo"]))
                    {
                        <div class="ozluluk-container">
                            <div>
                                <p><strong>Ad Soyad:</strong> @ogrenci.Adi @ogrenci.Soyadi</p>
                                <p><strong>TC Kimlik No:</strong> @ogrenci.TCKimlikNo</p>
                                <p><strong>Öğrenci No:</strong> @ogrenci.OgrenciNo</p>
                                <p><strong>Bölüm Adı:</strong> @ogrenci.Bolum.BolumAdi</p>
                            </div>
                            <div>
                                <p><strong>Tarih:</strong> @DateTime.Now</p>
                                <p><strong>Kayıt Tarihi:</strong> @ogrenci.KayitTarihi</p>
                                <p><strong>Ayrılış Tarihi:</strong> @ogrenci.AyrilmaTarihi</p>
                                <p><strong>Öğrenim Durumu:</strong> @ogrenci.Durumu</p>
                            </div>
                        </div>

                        <br />

                        <table class="table table-bordered" id="myTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Ders Kodu</th>
                                    <th>Ders Adı</th>
                                    <th>Ders Türü</th>
                                    <th>Teorik(T)</th>
                                    <th>Uygulama(U)</th>
                                    <th>Kredi(K)</th>
                                    <th>ECTS</th>
                                    <th>Sınav Notu</th>
                                    <th>Harf Notu</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>@item.DersHavuzu.DersID</td>
                                    <td>@item.DersHavuzu.DersKodu</td>
                                    <td>@item.DersHavuzu.DersAdi</td>
                                    <td>@item.DersHavuzu.DersTuru</td>
                                    <td>@item.DersHavuzu.Teorik</td>
                                    <td>@item.DersHavuzu.Uygulama</td>
                                    <td>@item.DersHavuzu.Kredi</td>
                                    <td>@item.DersHavuzu.ECTS</td>
                                    @*<td>@item.DersHavuzu.SinavNotu</td>
                                <td>@item.DersHavuzu.HarfNotu</td>*@
                                </tr>
                            </tbody>
                        </table>
                    }
                }
            }
        </div>

        <!-- Diğer script etiketleri burada yer alabilir -->
        <script>
            $(document).ready(function () {
                // DataTables initialization
                var dataTable = $('#myTable').DataTable({
                    "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "Tümü"]],
                    "pageLength": 10,
                });

                // Copy button
                var copy = new ClipboardJS('#copyButton', {
                    target: function (trigger) {
                        return document.querySelector('.table');
                    }
                });


                // Copy button success message
                copy.on('success', function (e) {
                    alert('Tablo kopyalandı!');
                });


            });
            document.getElementById('convertButton').addEventListener('click', function () {
                // Tabloyu içeren elementin ID'si ile tabloyu seç
                var myTable = document.getElementById('t');
                var secTable = myTable.cloneNode(true);
                // Belirli bir sütunu (kolonu) silen fonksiyon
                //function deleteColumn(columnIndex) {
                //    for (var i = 0; i < secTable.rows.length; i++) {
                //        secTable.rows[i].deleteCell(columnIndex);
                //    }
                //}

                //// Silinecek sütunun indeksini belirt
                //var columnIndexToDelete = 6; // Örneğin, 1. sütunu sil

                //// Belirtilen sütunu sil
                //deleteColumn(columnIndexToDelete);


                var inputHtml = document.getElementsByTagName('head')[0].innerHTML + secTable.outerHTML;
                var dataToSend = { inputData: inputHtml };

                fetch('/Transkript/ConvertToPdf', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.getElementsByName('__RequestVerificationToken')[0]
                    },
                    body: JSON.stringify(dataToSend)
                })
                    .then(response => response.blob())
                    .then(blob => {
                        // Code to download the PDF file
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.style.display = 'none';
                        a.href = url;
                        a.download = 'converted.pdf';
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                    })
                    .catch(error => console.error('Error:', error));
            });
            document.getElementById('exportExcelButton').addEventListener('click', function () {
                // Tabloyu içeren elementin ID'si ile tabloyu seç
                var myTable = document.getElementById('t');
                var secTable = t.cloneNode(true);
                //// Belirli bir sütunu (kolonu) silen fonksiyon
                //function deleteColumn(columnIndex) {
                //    for (var i = 0; i < secTable.rows.length; i++) {
                //        secTable.rows[i].deleteCell(columnIndex);
                //    }
                //}

                //// Silinecek sütunun indeksini belirt
                //var columnIndexToDelete = 6; // Örneğin, 1. sütunu sil

                //// Belirtilen sütunu sil
                //deleteColumn(columnIndexToDelete);

                // Export the modified table to Excel
                var wb = XLSX.utils.table_to_book(secTable, { sheet: "Sheet1" });
                var wbout = XLSX.write(wb, { bookType: 'xlsx', bookSST: true, type: 'blob' });

                // Code to download the Excel file
                saveAs(wbout, 'table.xlsx');
            });
            function saveAs(blob, fileName) {
                var a = document.createElement("a");
                document.body.appendChild(a);
                a.style = "display: none";
                var url = window.URL.createObjectURL(blob);
                a.href = url;
                a.download = fileName;
                a.click();
                window.URL.revokeObjectURL(url);
            }



        </script>
    </div>
</body>
</html>
