@model List<OgrenciBilgiSistemi.Models.Danismanlik>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Diğer head etiketleri burada yer alabilir -->

    <title>Öğrenci Bilgi Sistemi</title>

    <!-- DataTables CSS ve JS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.js"></script>

    <!-- Diğer script etiketleri burada yer alabilir -->
</head>
<body>
    <h1>Öğretim Elemanı Danışmanlık </h1>
    <br />
    <button id="copyButton" class="btn btn-primary">Kopyala</button>
    <button id="exportExcelButton" class="btn btn-success">Excele Aktar</button>
    <button id="exportPdfButton" class="btn btn-info">PDF'e Aktar</button>

    <br />
    <br />

    <table class="table table-bordered" id="myTable">
        <thead>
            <tr>
                @if (User.IsInRole("Öğretim Elemanı"))
                {
                    <th>#</th>
                    <th>Öğrenci Adı</th>
                    <th>Öğrenci Soyadı</th>
                    <th>Öğrenci Numarası</th>
                    <th>Öğrenci Bölümü</th>
                    <th>İşlemler</th>
                    
                }
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                if (User.IsInRole("Öğretim Elemanı"))
                {
                    <tr>
                        <td>@item.OgrenciID</td>
                        <td>@item.Ogrenci.Adi</td>
                        <td>@item.Ogrenci.Soyadi</td>
                        <td>@item.Ogrenci.OgrenciNo</td>
                        <td>@item.Ogrenci.Bolum.BolumAdi</td>
                        <td> @Html.ActionLink("Sil", "Sil", new { id = item.OgrenciID }, new { @class = "btn btn-danger", onclick = "return confirm('Silmek istiyor musunuz?')" })</td>
                        
                    </tr>
                }
            }
        </tbody>
    </table>

    <!-- Diğer script etiketleri burada yer alabilir -->

    <script>
        $(document).ready(function () {
            // DataTables'ı başlatın ve sayfalama kontrolünü kullanıcıya seçtirin
            var dataTable = $('#myTable').DataTable({
                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "Tümü"]],
                "pageLength": 10, // Varsayılan sayfa başına kayıt sayısı
            });

            // Sayfalama kontrolü değiştikçe DataTables'ı güncelleyin
            $('#pageLengthSelect').on('change', function () {
                var selectedValue = $(this).val();
                dataTable.page.len(selectedValue).draw();
            });

            // Kopyala işlemi için Clipboard.js kullanımı
            var clipboard = new ClipboardJS('.btn-primary', {
                text: function () {
                    var table = document.querySelector('.table');
                    var rows = Array.from(table.querySelectorAll('tr')).map(function (row) {
                        return Array.from(row.querySelectorAll('th, td')).map(function (cell) {
                            return cell.textContent.trim();
                        }).join('\t');
                    }).join('\n');
                    return rows;
                }
            });

            clipboard.on('success', function (e) {
                alert('Tablo kopyalandı!');
                e.clearSelection();
            });

            clipboard.on('error', function (e) {
                alert('Kopyalama başarısız!');
            });

            // Excele aktarma işlemi için SheetJS kullanımı
            function exportToExcel() {
                var table = document.querySelector('.table');
                var wb = XLSX.utils.table_to_book(table, { sheet: "Sheet1" });
                var wbout = XLSX.write(wb, { bookType: 'xlsx', bookSST: true, type: 'binary' });

                function s2ab(s) {
                    var buf = new ArrayBuffer(s.length);
                    var view = new Uint8Array(buf);
                    for (var i = 0; i != s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;
                    return buf;
                }

                saveAs(new Blob([s2ab(wbout)], { type: "application/octet-stream" }), 'tablo.xlsx');
            }

            // PDF'e aktarma işlemi için jsPDF kullanımı
            function exportToPDF() {
                var table = document.querySelector('.table');
                var pdf = new jsPDF('p', 'pt', 'letter');
                pdf.autoTable({ html: table });
                pdf.save('tablo.pdf');
            }
            
        });
    </script>

</body>
</html>
